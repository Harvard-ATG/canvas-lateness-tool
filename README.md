# canvas-lateness-tool

This is a command-line tool written in [python](https://www.python.org/) that uses the [canvas_python_sdk](https://github.com/penzance/canvas_python_sdk) to interact with the [Canvas API](https://canvas.instructure.com/doc/api/index.html).

## Instructions

### Setup Environment

To get started, you will need to setup your [python virtual environment](http://docs.python-guide.org/en/latest/dev/virtualenvs/) and then install the required python dependencies specified in the `requirements.txt` file:

```sh
$ virtualenv pyenv                  # create your virtual environment
$ source pyenv/bin/activate         # activate it
$ pip install -r requirements.txt   # install required dependencies
```
Then you will need to update your `.env` config with your personal `OAUTH_TOKEN`, which is required to authenticate with the Canvas API. To obtain a token, go to [your Canvas profile](https://canvas.harvard.edu/profile) and navigate to your [profile settings](https://canvas.harvard.edu/profile/settings). At the bottom of the settings page, you should see a button to create a **New Access Token**. When you click the button, it should open a dialog containing an access token. Copy and paste this value into your `.env` file such that `OAUTH_TOKEN="your_secret_token"`.

```sh
$ cp -v .env.example .env  # copy example configuration
$ nano .env                # edit config to update your oauth token
```

At this point you should have all required python dependencies and the required environment settings.

### Usage

The script takes a canvas course ID as input and then generates a report (an Excel spreadsheet and JSON file):

```sh
$ python canvas_lateness.py
usage: canvas_lateness.py [-h] [--use_cache] [--debug] course_id
```

Example:

```sh
$ python canvas_lateness.py 39
API fetching students for course: 39
Starting new HTTPS connection (1): canvas.harvard.edu
Writing data to: 39-cache.json
API fetching assignments for course: 39
Writing data to: 39-cache.json
API fetching submissions for course 39 and 1 assignments (assignment_ids: 65141)
[1 of 1] Fetching submissions for assignment_id: 65141...
Writing data to: 39-cache.json
Writing data to: 39-results-20160909.json
Writing spreadsheet to: 39-results-20160909.xls
```

You can then open the generated spreadsheet:

```sh
$ open 39-results-20160909.xls
```

##Excel Export

The excel spreadsheet generated by the script will have two worksheets. The first contains the _delta time_ (submitted - due) for each student's assignment. The second sheet contains the total lateness, or sum of all positive deltas, for each student. 

Note that assignments will only be included in the spreadsheet if they meet the following criteria:

1. The assignment has a due date.
2. The assignment has at least one submission.

### Sheet 1

| Assignment  | Week 1 Assignment    |                      |                 | Week 2 Assignment    |                      |                 |
|-------------|----------------------|----------------------|-----------------|----------------------|----------------------|-----------------|
| Students    | Due                  | Submitted            | Delta (seconds) | Due                  | Submitted            | Delta (seconds) |
| Last, First | 2016-04-12T03:59:00Z | 2016-04-12T18:47:08Z | 53288           | 2016-05-10T03:59:00Z | 2016-05-10T00:54:33Z | -11067          |
|             |                      |                      |                 |                      |                      |                 |

### Sheet 2

| Students    | Total (compact) | Total (hours) | Total (seconds) |
|-------------|-----------------|---------------|-----------------|
| Last, First | 2d83414s        | 71            | 256214          |
|             |                 |               |                 |
